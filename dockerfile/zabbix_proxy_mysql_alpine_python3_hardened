FROM zabbix/zabbix-proxy-mysql:alpine-7.0-latest

USER root

# ---- [ 1. System packages ] --------------------------------------------------
RUN apk add --no-cache \
    python3 \
    py3-pip \
    build-base \
    openssl \
    libffi-dev \
    musl-dev \
    gcc \
    libpq \
    curl \
    bash \
    ca-certificates \
    wget \
    git

# ---- [ 2. Python packages ] --------------------------------------------------
# Upgrade pip tooling first
RUN pip3 install --upgrade pip setuptools wheel

# Install Python dependencies
RUN pip3 install \
    requests \
    urllib3 \
    py-zabbix \
    cryptography \
    pyOpenSSL \
    idna \
    certifi \
    dnspython

# ---- [ 3. Validate installations ] -------------------------------------------
RUN python3 --version && \
    pip3 --version && \
    python3 -m pip show requests urllib3 py-zabbix cryptography pyOpenSSL

# ---- [ 4. Optional Debug Tooling ] -------------------------------------------
# Uncomment below if needed:
# RUN apk add --no-cache nmap tcpdump socat bind-tools

# ---- [ 5. Return to safe user ] ----------------------------------------------
USER zabbix