zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 92000e2973064387852d6dfd83dcbdec
      name: 'Templates/Server hardware'
  templates:
    - uuid: ec9518aebaf9473c8e47c41f56f2f385
      template: 'Tape Libraries'
      name: 'Tape Libraries'
      vendor:
        name: 'IBM'
        version: '8.x'
      description: |
        Overview
        Complete SNMP template for monitoring IBM, Dell, and Tandberg tape libraries.
        Supports common scalar metrics and discovery of components like drives, fans, and power supplies.

        Features
        - Device information: name, description, serial number, uptime.
        - Drive monitoring:
            - Auto-discovery of drives.
            - Status, availability, and cleaning requirement.
        - Library subsystem monitoring:
            - Door status, library operational state, transport robotics.
        - Fan and power supply discovery:
            - Status monitoring of physical components.
        - Alerting:
            - Triggers on door open, library not ready, drive failure, cleaning alerts, fan/PSU faults.

        Items
        - Uses SNMP to query scalar OIDs across standard and vendor-specific MIBs.
        - Preprocessing performed where required.

        Discovery rules
        - Drive discovery using SNIA-SML-MIB.
        - Fan and power supply discovery using ENTITY-MIB.

        Item prototypes
        - Drive availability and cleaning flags.
        - Fan and PSU operational state.

        Trigger prototypes
        - Library status not normal.
        - Door open state.
        - Drive unavailable.
        - Fan or PSU failure.

        Graphs
        - Drive alert summary.
        - Slot and drive count comparison.

        Supported devices
        - IBM TS4300, Dell TL1000/2000/4000, ML3, ML3e, ML6000 series.
        - Tandberg libraries and OEM variants using SNIA or Dell/IBM MIBs.

        Notes
        - Entity discovery uses substring matching on entPhysicalDescr.
        - Device compatibility depends on MIB support in SNMP agent.
        - Optimised for Zabbix 7.0+ and SNMPv2 environments.

        Author: Simon Jackson / @sjackson0109
      groups:
        - name: 'Applications'
      items:
        - uuid: 109f989c0c40428f8c939e90e68c14cd
          name: 'Device Uptime'
          type: SNMP_AGENT
          snmp_oid: 'SNMPv2-MIB::sysUpTime.0'
          key: 'sys.uptime'
          value_type: UNSIGNED
          units: seconds
          description: 'System uptime in hundredths of seconds'
          tags:
            - tag: component
              value: system
        - uuid: 5f6f53e12cfc499e9250be5366de83b1
          name: 'Device Name'
          type: SNMP_AGENT
          snmp_oid: 'SNMPv2-MIB::sysName.0'
          key: 'sys.name'
          value_type: CHAR
          tags:
            - tag: component
              value: system
        - uuid: c3808f057c0041c5880ad8116d3e040f
          name: 'Device Description'
          type: SNMP_AGENT
          snmp_oid: 'SNMPv2-MIB::sysDescr.0'
          key: 'sys.description'
          value_type: TEXT
          tags:
            - tag: component
              value: system
        - uuid: f4894978e9ff4ff9aba138ba56a32ea9
          name: 'Library Serial Number'
          type: SNMP_AGENT
          snmp_oid: 'DELL-TL2000-MIB::librarySerNum'
          key: 'library.serial'
          value_type: CHAR
          tags:
            - tag: component
              value: inventory
        - uuid: fe30b73fa84e454c9f518fb85d6d61d0
          name: 'Drive Count'
          type: SNMP_AGENT
          snmp_oid: 'DELL-TL2000-MIB::libraryDrvCnt'
          key: 'library.drives'
          value_type: UNSIGNED
          units: drives
          tags:
            - tag: component
              value: storage
        - uuid: 3bcab71c06054586b9271bd8b6b9a9e8
          name: 'Slot Count'
          type: SNMP_AGENT
          snmp_oid: 'DELL-TL2000-MIB::librarySlotCnt'
          key: 'library.slots'
          value_type: UNSIGNED
          units: slots
          tags:
            - tag: component
              value: storage
        - uuid: 759725944acf4fd98fd232c41cb82331
          name: 'Transport Robot Count'
          type: SNMP_AGENT
          snmp_oid: 'DELL-TL2000-MIB::libraryTranspCnt'
          key: 'library.transports'
          value_type: UNSIGNED
          units: robots
          tags:
            - tag: component
              value: hardware
        - uuid: 1ddd7231d26846a39d1eea0592f72af1
          name: 'Library State'
          type: SNMP_AGENT
          snmp_oid: 'DELL-TL2000-MIB::libraryState'
          key: 'library.state'
          value_type: UNSIGNED
          tags:
            - tag: component
              value: status
          triggers:
            - uuid: 96b7f83ed7714aedb0deedaa138afbcb
              name: 'Library state not normal'
              expression: '{Tape Libraries:library.state.last()} <> 1'
              priority: AVERAGE
              description: 'Library is not in normal (ready) state'
        - uuid: e62e99a0525b473595e2169119760654
          name: 'Door State'
          type: SNMP_AGENT
          snmp_oid: 'DELL-TL2000-MIB::libraryDoorState'
          key: 'library.door'
          value_type: UNSIGNED
          tags:
            - tag: component
              value: status
          triggers:
            - uuid: 225a4be656ab40f2853ad91fb08e587f
              name: 'Library Door Open'
              expression: '{Tape Libraries:library.door.last()} = 2'
              priority: WARNING
              description: 'Library access door is open'
      discovery_rules:
        - uuid: 41e0dcd7162e486ab0401cf52b9bb176
          name: 'Fan Discovery'
          key: 'snmpwalk["ENTITY-MIB::entPhysicalDescr"]'
          delay: 1h
          lifetime: 7d
          description: 'Discovers fans in the tape library.'
          item_prototypes:
            - uuid: c835e13fe696475cba89f15a0866ba20
              name: 'Fan {#FAN.ID} Operational State'
              key: 'fan.state[{#FAN.ID}]'
              type: DEPENDENT
              value_type: UNSIGNED
              master_item:
                key: 'snmpwalk["ENTITY-MIB::entPhysicalDescr"]'
              trigger_prototypes:
                - uuid: cd82aa8df39445a2b013cc57da1175c9
                  name: 'Fan {#FAN.ID} Failure'
                  expression: 'last(/Tape Libraries/fan.state[{#FAN.ID}])<>1'
                  priority: AVERAGE
                  description: 'Fan {#FAN.ID} is not operational.'
        - uuid: 6c4d3ee6ac7642a0a6c3ec17d16489b0
          name: 'Power Supply Discovery'
          key: 'snmpwalk["ENTITY-MIB::entPhysicalDescr"]'
          delay: 1h
          lifetime: 7d
          description: 'Discovers power supplies in the tape library.'
          item_prototypes:
            - uuid: 3afd2c2d33c84e9d98b3ba29b4cbda99
              name: 'Power Supply {#PSU.ID} Operational State'
              key: 'psu.state[{#PSU.ID}]'
              type: DEPENDENT
              value_type: UNSIGNED
              master_item:
                key: 'snmpwalk["ENTITY-MIB::entPhysicalDescr"]'
              trigger_prototypes:
                - uuid: 25a5ba7598bf41018e94f6581d780308
                  name: 'Power Supply {#PSU.ID} Failure'
                  expression: 'last(/Tape Libraries/psu.state[{#PSU.ID}])<>1'
                  priority: AVERAGE
                  description: 'Power Supply {#PSU.ID} is not operational.'
        - uuid: 0b667f017d5f4f1194b1a8178d73e0c8
          name: 'Library Status Discovery'
          key: 'snmpwalk["DELL-TL2000-MIB::libraryState"]'
          delay: 1h
          lifetime: 7d
          description: 'Discovers library status metrics.'
          item_prototypes:
            - uuid: 9112b72f01aa4b6da1535ad0d7733605
              name: 'Library {#LIBRARY.ID} Status'
              key: 'library.status[{#LIBRARY.ID}]'
              type: DEPENDENT
              value_type: UNSIGNED
              master_item:
                key: 'snmpwalk["DELL-TL2000-MIB::libraryState"]'
      tags:
        - tag: Author
          value: 'Simon Jackson'
      valuemaps:
        - uuid: c033100906c040f1b8a56b5e51660d3c
          name: 'TapeLibraryStatus'
          mappings:
            - value: '1'
              newvalue: 'Normal'
            - value: '2'
              newvalue: 'Idle'
            - value: '3'
              newvalue: 'Standby'
            - value: '0'
              newvalue: 'Unknown'
  graphs:
    - uuid: 025438ab54d4458292a83fcd5e161dbe
      name: 'Drive Alert Summary'
      graph_items:
        - color: FF0000
          drawtype: SINGLE_LINE
          item:
            host: 'Tape Libraries'
            key: 'drives.alerts'
    - uuid: 2bb6db4979c84e60a742d68da41f33ef
      name: 'Slot and Drive Count Comparison'
      graph_items:
        - sortorder: '0'
          color: 0000FF
          drawtype: SINGLE_LINE
          item:
            host: 'Tape Libraries'
            key: 'library.slots'
        - sortorder: '1'
          color: 00FF00
          drawtype: SINGLE_LINE
          item:
            host: 'Tape Libraries'
            key: 'library.drives'
    - uuid: 9402a79c83d04c379d47a2f4df1af996
      name: 'Transport Robot Count'
      graph_items:
        - color: FFA500
          drawtype: SINGLE_LINE
          item:
            host: 'Tape Libraries'
            key: 'library.transports'
    - uuid: 9e56e72a5c1348668b3f251fec0c06fa
      name: 'Device Uptime'
      graph_items:
        - color: '800080'
          drawtype: SINGLE_LINE
          item:
            host: 'Tape Libraries'
            key: 'sys.uptime'
