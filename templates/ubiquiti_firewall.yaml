zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: c5381dc540504dbba10e2d300554e4cd
      name: Firewall
  templates:
    - uuid: 56f842074baf4904a12b5bf3cbafda82
      template: 'Ubiquiti Firewall'
      name: 'Ubiquiti Firewall'
      description: |
        Overview
        This template monitors Ubiquiti UniFi Security Gateway (USG), UniFi Dream Machine (UDM), and EdgeRouter series devices using SNMPv2.
        It provides metrics on system health, interfaces, CPU, memory, active sessions, and basic traffic statistics.
        
        Features
        - Device identification (model, name, location, uptime)
        - CPU and memory utilisation tracking
        - Interface traffic (in/out) and operational status
        - Active session count (established connections)
        - SNMP-based discovery of physical interfaces
        - Basic triggers for CPU/memory overuse and interface state change
        - Graphs for bandwidth and session statistics
        
        Items
        - System info (uptime, hostname, description)
        - CPU and memory usage
        - Active session count
        - Per-interface byte counters and status
        
        Discovery rules
        - Physical interface discovery using `ifDescr` and `ifOperStatus`
        
        Item prototypes
        - Interface in/out bytes per second
        - Interface operational status
        
        Trigger prototypes
        - Interface down alert
        - High CPU/memory usage alerts (optional based on thresholds)
        
        Graph prototypes
        - Interface traffic overview (in/out)
        - Session count trends
        
        Supported devices
        - Ubiquiti UniFi Security Gateway (USG/USG-Pro)
        - Ubiquiti EdgeRouter series (ER-X, ER-4, ER-12, etc.)
        - UniFi Dream Machine (basic support, SNMP limitations apply)
        
        Notes
        - Requires SNMP enabled on the device and allowed from the Zabbix proxy/server
        - Interface counters are in octets and converted to bits per second
        - SNMP agent responses may vary slightly across firmware or product lines
        
        Author: Simon Jackson / @sjackson0109
      groups:
        - name: Firewall
      items:
        - uuid: 606d32919a37442da1d30e4704e8d6db
          name: 'Device Contact'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.4.0
          key: system.contact
          delay: 1h
          value_type: TEXT
          trends: '0'
          description: 'Contact details for the device administrator, pulled from SNMP sysContact.'
          tags:
            - tag: Component
              value: System
        - uuid: f988d09c240049dda12bceddec271c11
          name: 'Device Location'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.6.0
          key: system.location
          delay: 1h
          value_type: TEXT
          trends: '0'
          description: 'System location string as configured on the device SNMP agent.'
          tags:
            - tag: Component
              value: System
        - uuid: 02081567d1c847748a6a5c86bcb44339
          name: 'Device Name'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.5.0
          key: system.name
          delay: 1h
          value_type: TEXT
          trends: '0'
          description: 'System name or hostname as defined by SNMP on the device.'
          tags:
            - tag: Component
              value: System
        - uuid: 46fdc243c34a4246a0d7f9b85c9cd3bd
          name: 'Device Uptime'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: system.uptime
          delay: 1h
          trends: '0'
          units: s
          description: 'The time since the network management portion of the system was last re-initialised.'
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '0.01'
          tags:
            - tag: Component
              value: System
          triggers:
            - uuid: bc1a707939cc4f1f9053b764da3576fd
              expression: 'last(/Ubiquiti Firewall/system.uptime)<{$UBIQUITI_UPTIME_MIN}'
              name: 'Device rebooted recently'
              priority: WARNING
              description: |
                The device has restarted within the last 10 minutes.
                This could indicate planned maintenance or unexpected reboot.
              manual_close: 'YES'
              tags:
                - tag: Component
                  value: System
                - tag: Metrics
                  value: Uptime
                - tag: Symptom
                  value: Stability
        - uuid: 88e56781c59c4534b34535e5118b3c37
          name: 'CPU Utilisation'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.2021.11.11.0
          key: ubiquiti.cpu.utilisation
          value_type: FLOAT
          units: '%'
          description: 'CPU utilisation percentage over the last 1 minute.'
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '0.01'
            - type: MULTIPLIER
              parameters:
                - '10'
          tags:
            - tag: Component
              value: CPU
            - tag: Metrics
              value: Performance
          triggers:
            - uuid: f84dfd56bd6a4481b66117c84ee7cace
              expression: 'avg(/Ubiquiti Firewall/ubiquiti.cpu.utilisation,#5)>{$UBIQUITI_CPU_UTIL_MAX}'
              name: 'High CPU Utilisation'
              priority: AVERAGE
              description: 'CPU utilisation exceeds {$UBIQUITI_CPU_UTIL_MAX}% averaged across 5 samples. High CPU usage may impact routing performance and responsiveness.'
              manual_close: 'YES'
              tags:
                - tag: Component
                  value: CPU
                - tag: Metrics
                  value: Utilisation
                - tag: Severity
                  value: Threshold
        - uuid: 4089e976efab4bc4b3e864ea02c4f3f2
          name: 'Memory Available'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.2021.4.6.0
          key: ubiquiti.memory.available
          units: B
          description: 'Available real memory (free physical RAM) in bytes.'
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            - tag: Component
              value: RAM
            - tag: Metrics
              value: Performance
        - uuid: 0967ad8761a94aa784e9a3b8717148d9
          name: 'Memory Total'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.2021.4.5.0
          key: ubiquiti.memory.total
          units: B
          description: 'Total real memory (physical RAM) in bytes.'
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            - tag: Component
              value: RAM
            - tag: Metrics
              value: Performance
        - uuid: 1c8baf30c99b4f0c8f2fc5718cabb436
          name: 'Active Sessions'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.2021.255.10.0
          key: ubiquiti.sessions.active
          description: 'Current number of active tracked sessions (e.g., via conntrack or session table). Requires custom SNMP extend.'
          tags:
            - tag: Component
              value: Firewall
            - tag: Metrics
              value: Sessions
          triggers:
            - uuid: db3943a9921c40669d810e72f581a7cb
              expression: 'avg(/Ubiquiti Firewall/ubiquiti.sessions.active,#5)>{$UBIQUITI_SESSION_COUNT_MAX}'
              name: 'High session count'
              priority: AVERAGE
              description: 'High session count detected over 5 samples. May indicate scanning, DoS, or high concurrent usage.'
              tags:
                - tag: Component
                  value: Firewall
                - tag: Metrics
                  value: Sessions
        - uuid: 9741ad1f9a5541988ffd55a75751cee5
          name: 'Swap Available'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.2021.4.6.0
          key: ubiquiti.swap.available
          units: B
          description: 'Available swap memory in bytes.'
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            - tag: Component
              value: RAM
            - tag: Metrics
              value: Performance
        - uuid: fb888a403e584b10b4221208cf9bea73
          name: 'Swap Total'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.2021.4.3.0
          key: ubiquiti.swap.total
          units: B
          description: 'Total swap space in bytes.'
          preprocessing:
            - type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            - tag: Component
              value: RAM
            - tag: Metrics
              value: Performance
        - uuid: f97837885ec74cb09048f39bef05a179
          name: 'Disk Throughput Read'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.2021.11.6.0
          key: ubiquiti.system.io.read
          delay: 5m
          units: Bps
          description: 'Disk read throughput in bytes per second.'
          preprocessing:
            - type: CHANGE_PER_SECOND
              parameters:
                - ''
            - type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            - tag: Component
              value: IO
            - tag: Metrics
              value: Performance
        - uuid: b491e2dd2f11488b9d5d78abf4acf985
          name: 'Disk Throughput Write'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.2021.11.5.0
          key: ubiquiti.system.io.write
          delay: 5m
          units: Bps
          description: 'Disk write throughput in bytes per second.'
          preprocessing:
            - type: CHANGE_PER_SECOND
              parameters:
                - ''
            - type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            - tag: Component
              value: IO
            - tag: Metrics
              value: Performance
      discovery_rules:
        - uuid: 166ecd2529ee48c0bc20ee21db4c0c1e
          name: 'Disks (Physical)'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#DISKINDEX},.1.3.6.1.4.1.2021.9.1.1,{#DISKPATH},.1.3.6.1.4.1.2021.9.1.2]'
          key: ubiquiti.disk.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#DISKPATH}'
                value: '^/(?!proc|sys|dev|run|tmp|mnt|overlay).*'
                formulaid: A
          description: 'Discover physical disks'
          item_prototypes:
            - uuid: e7e12b83406c4a739ea77afa8d8d6d1f
              name: 'Disk: {#DISKPATH} Available Space'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2021.9.1.7.{#DISKINDEX}'
              key: 'storage.avail.bytes[{#DISKINDEX}]'
              units: B
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '1024'
              tags:
                - tag: Component
                  value: Disk
                - tag: Metrics
                  value: Performance
            - uuid: 36e8f3ecbc074f25a575e670cc34af56
              name: 'Disk: {#DISKPATH} Used Space'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2021.9.1.8.{#DISKINDEX}'
              key: 'storage.used.bytes[{#DISKINDEX}]'
              units: B
              preprocessing:
                - type: MULTIPLIER
                  parameters:
                    - '1024'
              tags:
                - tag: Component
                  value: Disk
                - tag: Metrics
                  value: Performance
            - uuid: a192882a1cc34a7eab6f385b9ced1b5b
              name: 'Disk: {#DISKPATH} Used %'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2021.9.1.9.{#DISKINDEX}'
              key: 'storage.used.percent[{#DISKINDEX}]'
              units: '%'
              tags:
                - tag: Component
                  value: Disk
                - tag: Metrics
                  value: Performance
        - uuid: 61254f6b14f4466791cb49f77d5fef87
          name: 'File System'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#HRSTORAGEINDEX},.1.3.6.1.2.1.25.2.3.1.1,{#HRSTORAGEDESCR},.1.3.6.1.2.1.25.2.3.1.3,{#HRSTORAGEUNIT},.1.3.6.1.2.1.25.2.3.1.4]'
          key: ubiquiti.fs.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#HRSTORAGEDESCR}'
                value: ^\/
                formulaid: A
          description: 'Discovers only storage entries that represent mounted file systems, based on hrStorageDescr values beginning with "/". This excludes memory-related entries such as physical, virtual, or swap memory. Suitable for monitoring disk usage.'
          item_prototypes:
            - uuid: 2db8faf93fc44fe58fe512f824b8e115
              name: 'FS: {#HRSTORAGEDESCR} Total Space'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.5.{#HRSTORAGEINDEX}'
              key: 'ubiquiti.fs.total.bytes[{#HRSTORAGEINDEX}]'
              delay: 5m
              units: B
              description: 'Total available storage space for {#HRSTORAGEDESCR}, derived from hrStorageSize × hrStorageAllocationUnits.'
              tags:
                - tag: Component
                  value: FileSystem
                - tag: Metrics
                  value: Performance
            - uuid: 92f37937ec114e6193ed0a1ccc9729e8
              name: 'FS: {#HRSTORAGEDESCR} Used Space'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.6.{#HRSTORAGEINDEX}'
              key: 'ubiquiti.fs.used.bytes[{#HRSTORAGEINDEX}]'
              delay: 5m
              units: B
              description: 'Amount of used storage space for {#HRSTORAGEDESCR}, converted from SNMP allocation units to bytes.'
              tags:
                - tag: Component
                  value: FileSystem
                - tag: Metrics
                  value: Performance
          graph_prototypes:
            - uuid: 8ce8b8eac68d4e66b07e10d4bb921f8c
              name: 'FS: {#HRSTORAGEDESCR} Consumption'
              graph_items:
                - color: 199C0D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.fs.used.bytes[{#HRSTORAGEINDEX}]'
                - sortorder: '1'
                  color: 0080FF
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.fs.used.bytes[{#HRSTORAGEINDEX}]'
        - uuid: 06fb327aff674e1cb429b5c95c39563d
          name: 'Interfaces (Ethernet)'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: ubiquiti.interface.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#IFDESCR}'
                value: '^eth[0-9]+$'
                formulaid: A
              - macro: '{#IFTYPE}'
                value: ^(6|117|161)$
                formulaid: B
          item_prototypes:
            - uuid: 626a71ce873a4f8b890e4708d1d1f562
              name: 'Interface: {#IFDESCR} Errors In'
              type: SNMP_AGENT
              snmp_oid: 'IF-MIB::ifInErrors.{#SNMPINDEX}'
              key: 'interface.ifInErrors[{#SNMPINDEX}]'
              units: Bps
              description: 'Inbound error count on interface {#IFDESCR}, converted to bits per second.no'
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: Ethernet
                - tag: Metrics
                  value: Errors
                - tag: Name
                  value: '{#IFDESCR}'
              trigger_prototypes:
                - uuid: 692a53690e984b548d5ab99f965b2b30
                  expression: 'avg(/Ubiquiti Firewall/interface.ifInErrors[{#SNMPINDEX}],5m) > {$UBIQUITI_INTERFACE_ERROR_THRESHOLD}'
                  name: 'Interface {#IFDESCR} Inbound Errors High'
                  priority: AVERAGE
                  description: 'Interface {#IFDESCR} is experiencing a high number of RECEIVE errors. This may indicate bad cabling, duplex mismatch, or hardware issues.'
                  tags:
                    - tag: Component
                      value: Interface
                    - tag: Interface
                      value: Ethernet
                    - tag: Symptoms
                      value: HighErrorCount
            - uuid: d41dfad06e1b4efaa6a47a2c58317430
              name: 'Interface: {#IFDESCR} Bytes In'
              type: SNMP_AGENT
              snmp_oid: 'IF-MIB::ifInOctets.{#SNMPINDEX}'
              key: 'interface.ifInOctets[{#SNMPINDEX}]'
              units: Bps
              description: 'Inbound traffic on interface {#IFDESCR}, in bits per second.'
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: Ethernet
                - tag: Metrics
                  value: Traffic
                - tag: Name
                  value: '{#IFDESCR}'
            - uuid: 809e9308de8943169024c66b5bd88903
              name: 'Interface: {#IFDESCR} Errors Out'
              type: SNMP_AGENT
              snmp_oid: 'IF-MIB::ifOutErrors.{#SNMPINDEX}'
              key: 'interface.ifOutErrors[{#SNMPINDEX}]'
              units: Bps
              description: 'Outbound error count on interface {#IFDESCR}, converted to bits per second.'
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: Ethernet
                - tag: Metrics
                  value: Errors
                - tag: Name
                  value: '{#IFDESCR}'
              trigger_prototypes:
                - uuid: 6d1ad7bc30bb4dc882e5057d79c4950b
                  expression: 'avg(/Ubiquiti Firewall/interface.ifOutErrors[{#SNMPINDEX}],5m) > {$UBIQUITI_INTERFACE_ERROR_THRESHOLD}'
                  name: 'Interface {#IFDESCR} Outbound Errors High'
                  priority: AVERAGE
                  description: 'Interface {#IFDESCR} is experiencing a high number of SEND errors. This may indicate bad cabling, duplex mismatch, or hardware issues.'
                  tags:
                    - tag: Component
                      value: Interface
                    - tag: Interface
                      value: Ethernet
                    - tag: Symptoms
                      value: HighErrorCount
            - uuid: 1c7d336fe07746c199543159a8ce8ff9
              name: 'Interface: {#IFDESCR} Bytes Out'
              type: SNMP_AGENT
              snmp_oid: 'IF-MIB::ifOutOctets.{#SNMPINDEX}'
              key: 'interface.ifOutOctets[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: Ethernet
                - tag: Metrics
                  value: Traffic
                - tag: Name
                  value: '{#IFDESCR}'
            - uuid: 57a29a91e29d49d8984a6f263cf625da
              name: 'Interface: {#IFDESCR} Status'
              type: SNMP_AGENT
              snmp_oid: 'IF-MIB::ifOperStatus.{#SNMPINDEX}'
              key: 'interface.status[{#SNMPINDEX}]'
              valuemap:
                name: interface.status.valuemap
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: Ethernet
                - tag: Metrics
                  value: Status
                - tag: Name
                  value: '{#IFDESCR}'
              trigger_prototypes:
                - uuid: 3b0cb9c04da745d4b024e3f093a5a946
                  expression: 'min(/Ubiquiti Firewall/interface.status[{#SNMPINDEX}],5m) = 2'
                  name: 'Interface {#IFDESCR} status changed'
                  priority: WARNING
                  description: 'Detects when the interface {#IFDESCR} enters a ''down'' state at least once within the last 3 minutes. This may indicate a physical disconnect, link loss, or transient failure. Intended to suppress brief or transitional link-state flaps while still alerting on true interface outages.'
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: Interface
                    - tag: Interface
                      value: Ethernet
                    - tag: Symptom
                      value: Flap/Down
          graph_prototypes:
            - uuid: 8c8a66a5190746db8d519d479803d17f
              name: 'Interface {#IFDESCR} Traffic'
              graph_items:
                - color: 199C0D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'interface.ifInOctets[{#SNMPINDEX}]'
                - sortorder: '1'
                  color: 00BFFF
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'interface.ifOutOctets[{#SNMPINDEX}]'
                - sortorder: '2'
                  drawtype: FILLED_REGION
                  color: CC6600
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'interface.ifInErrors[{#SNMPINDEX}]'
                - sortorder: '3'
                  drawtype: FILLED_REGION
                  color: FF0000
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'interface.ifOutErrors[{#SNMPINDEX}]'
        - uuid: dd44eab3558a403eb3c2641a9005449b
          name: Memory
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#HRSTORAGEINDEX},.1.3.6.1.2.1.25.2.3.1.1,{#HRSTORAGEDESCR},.1.3.6.1.2.1.25.2.3.1.3,{#HRSTORAGEUNIT},.1.3.6.1.2.1.25.2.3.1.4]'
          key: ubiquiti.memory.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#HRSTORAGEDESCR}'
                value: '^(Virtual memory|virtual memory|Memory buffers|memory buffers|Cached memory|cached memory|Shared memory|shared memory|Swap space|swap space)$'
                formulaid: A
          description: 'Discovers memory-related storage segments such as virtual memory, buffers, cache, shared memory, and swap. This excludes physical memory and mounted file systems.'
          item_prototypes:
            - uuid: f633b66d475b40cb94acfa6f01e505e3
              name: 'Memory: {#HRSTORAGEDESCR} Total'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.5.{#HRSTORAGEINDEX}'
              key: 'ubiquiti.memory.total.bytes[{#HRSTORAGEINDEX}]'
              delay: 5m
              units: B
              description: 'Total available storage memory for {#HRSTORAGEDESCR}, derived from hrStorageSize × hrStorageAllocationUnits.'
              tags:
                - tag: Component
                  value: Memory
                - tag: Metrics
                  value: Performance
            - uuid: 5978dff9187342bbb6da7e8128c88e8e
              name: 'Memory: {#HRSTORAGEDESCR} Used'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.6.{#HRSTORAGEINDEX}'
              key: 'ubiquiti.memory.used.bytes[{#HRSTORAGEINDEX}]'
              delay: 5m
              units: B
              description: 'Amount of used storage memory for {#HRSTORAGEDESCR}, converted from SNMP allocation units to bytes.'
              tags:
                - tag: Component
                  value: Memory
                - tag: Metrics
                  value: Performance
          graph_prototypes:
            - uuid: 8bfdf7e6cd1449f6aff2ce5c2195f40d
              name: 'Memory Footprint (#HRSTORAGEDESCR)'
              yaxismax: '0'
              show_work_period: 'NO'
              show_triggers: 'NO'
              type: PIE
              graph_items:
                - color: 199C0D
                  calc_fnc: MIN
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.memory.total.bytes[{#HRSTORAGEINDEX}]'
                - sortorder: '1'
                  color: 0080FF
                  calc_fnc: MIN
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.memory.used.bytes[{#HRSTORAGEINDEX}]'
        - uuid: e3b76b160d2e460ba3c8a6a45e6ab27b
          name: Processes
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#PROCESSINDEX},1.3.6.1.4.1.2021.2.1.1,{#PROCESSNAME},1.3.6.1.4.1.2021.2.1.2]'
          key: ubiquiti.process.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#PROCESSNAME}'
                value: '^(?!kworker|migration|rcu|watchdog).*'
                formulaid: A
          item_prototypes:
            - uuid: 5351f346518b4124b7ea5362f0de350a
              name: 'Process: {#PROCESSNAME} Count'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2021.2.1.5.{#PROCESSINDEX}'
              key: 'ubiquiti.process.count[{#PROCESSINDEX}]'
              delay: 2m
              description: 'Number of active processes matching {#PROCESSNAME} currently running.'
              tags:
                - tag: Component
                  value: Processes
                - tag: Metrics
                  value: Performance
              trigger_prototypes:
                - uuid: 9136ac07279e4fb8857fd58fc25592d8
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.process.count[{#PROCESSINDEX}],#5)=0'
                  name: 'Process {#PROCESSNAME} is not running'
                  priority: AVERAGE
                  description: 'No instances of {#PROCESSNAME} detected over 5 samples. Process may have crashed or failed to start.'
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: Processes
                    - tag: Symptoms
                - uuid: 9cb53a445c5f472c91b5138f1218816a
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.process.count[{#PROCESSINDEX}],#5)< {$UBIQUITI_PROCESS_MIN:"{#PROCESSNAME}"}'
                  name: 'Too few {#PROCESSNAME} processes running'
                  priority: AVERAGE
                  description: 'Average number of running {#PROCESSNAME} processes over 5 samples is below expected threshold.'
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: Processes
                    - tag: Symptoms
                - uuid: 8f6eb41b9e0b43479c1bb2dcd114eb14
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.process.count[{#PROCESSINDEX}],#5)< {$UBIQUITI_PROCESS_MAX:"{#PROCESSNAME}"}'
                  name: 'Too many {#PROCESSNAME} processes running'
                  priority: AVERAGE
                  description: 'Average process count over 5 samples for {#PROCESSNAME} exceeds expected range.'
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: Processes
                    - tag: Symptoms
        - uuid: e3713ab35f174dd6813c058b36eb91a5
          name: 'Route Table'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#ROUTEDEST},1.3.6.1.2.1.4.21.1.1,{#ROUTEMASK},1.3.6.1.2.1.4.21.1.11,{#IFINDEX},1.3.6.1.2.1.4.21.1.2snmp_oid: ''discovery[{#ROUTEDEST},1.3.6.1.2.1.4.21.1.1,{#ROUTEMASK},1.3.6.1.2.1.4.21.1.11,{#IFINDEX},1.3.6.1.2.1.4.21.1.2,{#IFDESCR},1.3.6.1.2.1.2.2.1.2.{#IFINDEX}]'
          key: ubiquiti.route.discovery
          delay: 1h
          description: 'Discovers all entries in the IPv4 routing table, mapping route destinations to their outgoing interfaces.'
          item_prototypes:
            - uuid: daee526fbc8a42eba654b69161188b17
              name: 'Route: {#ROUTEDEST}/{#ROUTEMASK} Interface Description'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.2.{#IFINDEX}'
              key: 'ubiquiti.route.ifdescr[{#ROUTEDEST}/{#ROUTEMASK}]'
              delay: 1h
              value_type: CHAR
              trends: '0'
              description: 'Textual name of the interface used for route to {#ROUTEDEST}/{#ROUTEMASK}.'
              tags:
                - tag: Component
                  value: Routing
                - tag: Route-Destination
                  value: '{#ROUTEDEST}{#ROUTEMASK}'
            - uuid: 377c2b53c13c42efa305066ac525507c
              name: 'Route: {#ROUTEDEST}/{#ROUTEMASK} via {#IFDESCR}'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.4.21.1.2.{#ROUTEDEST}'
              key: 'ubiquiti.route.ifindex[{#ROUTEDEST}/{#ROUTEMASK}]'
              description: 'Interface index for destination {#ROUTEDEST}/{#ROUTEMASK} (based on ipRouteIfIndex).'
              tags:
                - tag: Component
                  value: Routing
                - tag: Route-Destination
                  value: '{#ROUTEDEST}{#ROUTEMASK}'
            - uuid: a09a10d1072547e78743dd68170c3377
              name: 'Route: {#ROUTEDEST}/{#ROUTEMASK} Metric'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.4.21.1.3.{#ROUTEDEST}'
              key: 'ubiquiti.route.metric[{#ROUTEDEST}/{#ROUTEMASK}]'
              description: 'Route metric (ipRouteMetric1) for destination {#ROUTEDEST}/{#ROUTEMASK}.'
              tags:
                - tag: Component
                  value: Routing
                - tag: Route-Destination
                  value: '{#ROUTEDEST}{#ROUTEMASK}'
            - uuid: 8a9055e8f137438d9d38f89de0ee5af1
              name: 'Route: {#ROUTEDEST}/{#ROUTEMASK} Next Hop'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.4.21.1.7.{#ROUTEDEST}'
              key: 'ubiquiti.route.nexthop[{#ROUTEDEST}/{#ROUTEMASK}]'
              description: 'IP address of the next hop for the route to {#ROUTEDEST}/{#ROUTEMASK}.'
              tags:
                - tag: Component
                  value: Routing
                - tag: Route-Destination
                  value: '{#ROUTEDEST}/{#ROUTEMASK}'
            - uuid: 4c04281fea6e414c855a8097ace951f8
              name: 'Route: {#ROUTEDEST}/{#ROUTEMASK} Type'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.4.21.1.8.{#ROUTEDEST}'
              key: 'ubiquiti.route.type[{#ROUTEDEST}/{#ROUTEMASK}]'
              description: 'Indicates the route type (1: other, 2: invalid, 3: direct, 4: indirect).'
              tags:
                - tag: Component
                  value: Routing
                - tag: Route-Destination
                  value: '{#ROUTEDEST}/{#ROUTEMASK}'
          trigger_prototypes:
            - uuid: 5238a27d2a8146ac8d16fe25e44a7d0b
              expression: |
                avg(/Ubiquiti Firewall/ubiquiti.route.ifindex[{#ROUTEDEST}/{#ROUTEMASK}],#5)<>last(/Ubiquiti Firewall/ubiquiti.route.ifindex[{#ROUTEDEST}/{#ROUTEMASK}])
                    or
                    avg(/Ubiquiti Firewall/ubiquiti.route.nexthop[{#ROUTEDEST}/{#ROUTEMASK}],#5)<>last(/Ubiquiti Firewall/ubiquiti.route.nexthop[{#ROUTEDEST}/{#ROUTEMASK}])
              name: 'Route: {#ROUTEDEST}/{#ROUTEMASK} path changed'
              priority: INFO
              description: |
                Detected a stable change in routing for {#ROUTEDEST}/{#ROUTEMASK}.
                The outgoing interface or next hop has altered consistently over 5 polling cycles.
                This may indicate BGP convergence, VPN tunnel drop or fallback routing.
              manual_close: 'YES'
              tags:
                - tag: Component
                  value: Routing
                - tag: Route
                  value: '{#ROUTEDEST}/{#ROUTEMASK}'
                - tag: Type
                  value: PathChange
          preprocessing:
            - type: STR_REPLACE
              parameters:
                - 255.255.255.255
                - '32'
            - type: STR_REPLACE
              parameters:
                - 255.255.255.254
                - '31'
            - type: STR_REPLACE
              parameters:
                - 255.255.255.252
                - '30'
            - type: STR_REPLACE
              parameters:
                - 255.255.255.248
                - '29'
            - type: STR_REPLACE
              parameters:
                - 255.255.255.240
                - '28'
            - type: STR_REPLACE
              parameters:
                - 255.255.255.224
                - '27'
            - type: STR_REPLACE
              parameters:
                - 255.255.255.192
                - '26'
            - type: STR_REPLACE
              parameters:
                - 255.255.255.128
                - '25'
            - type: STR_REPLACE
              parameters:
                - 255.255.255.0
                - '24'
            - type: STR_REPLACE
              parameters:
                - 255.255.254.0
                - '23'
            - type: STR_REPLACE
              parameters:
                - 255.255.252.0
                - '22'
            - type: STR_REPLACE
              parameters:
                - 255.255.248.0
                - '21'
            - type: STR_REPLACE
              parameters:
                - 255.255.240.0
                - '20'
            - type: STR_REPLACE
              parameters:
                - 255.255.224.0
                - '19'
            - type: STR_REPLACE
              parameters:
                - 255.255.192.0
                - '18'
            - type: STR_REPLACE
              parameters:
                - 255.255.128.0
                - '17'
            - type: STR_REPLACE
              parameters:
                - 255.255.0.0
                - '16'
            - type: STR_REPLACE
              parameters:
                - 255.254.0.0
                - '15'
            - type: STR_REPLACE
              parameters:
                - 255.252.0.0
                - '14'
            - type: STR_REPLACE
              parameters:
                - 255.248.0.0
                - '13'
            - type: STR_REPLACE
              parameters:
                - 255.240.0.0
                - '12'
            - type: STR_REPLACE
              parameters:
                - 255.224.0.0
                - '11'
            - type: STR_REPLACE
              parameters:
                - 255.192.0.0
                - '10'
            - type: STR_REPLACE
              parameters:
                - 255.128.0.0
                - '9'
            - type: STR_REPLACE
              parameters:
                - 255.0.0.0
                - '8'
            - type: STR_REPLACE
              parameters:
                - 254.0.0.0
                - '7'
            - type: STR_REPLACE
              parameters:
                - 252.0.0.0
                - '6'
            - type: STR_REPLACE
              parameters:
                - 248.0.0.0
                - '5'
            - type: STR_REPLACE
              parameters:
                - 240.0.0.0
                - '4'
            - type: STR_REPLACE
              parameters:
                - 224.0.0.0
                - '3'
            - type: STR_REPLACE
              parameters:
                - 192.0.0.0
                - '2'
            - type: STR_REPLACE
              parameters:
                - 128.0.0.0
                - '1'
            - type: STR_REPLACE
              parameters:
                - 0.0.0.0
                - '0'
        - uuid: ca54b14495fa4718a25c16a1e8ff6e63
          name: 'Interfaces (VLAN)'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: ubiquiti.vlan.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#IFDESCR}'
                value: '^eth[0-9]+\.[0-9]+$'
                formulaid: A
              - macro: '{#IFTYPE}'
                value: ^(6|53|135)$
                formulaid: B
          item_prototypes:
            - uuid: 29c683bdf87c49659b169b3fe44bbf21
              name: 'VLAN: {#IFDESCR} Bytes In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.6.{#SNMPINDEX}'
              key: 'vlan.bytes.in[{#IFDESCR}]'
              value_type: FLOAT
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: VLAN
                - tag: Metrics
                  value: Traffic
                - tag: VLAN
                  value: '{#IFDESCR}'
            - uuid: 9f094d5c80b34cb5a580ad0f41fdd78d
              name: 'VLAN: {#IFDESCR} Bytes Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.10.{#SNMPINDEX}'
              key: 'vlan.bytes.out[{#IFDESCR}]'
              value_type: FLOAT
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: VLAN
                - tag: Metrics
                  value: Traffic
                - tag: VLAN
                  value: '{#IFDESCR}'
            - uuid: 24eceb0f0ee34baf8543e6bf821d9260
              name: 'VLAN: {#IFDESCR} Errors In'
              type: SNMP_AGENT
              snmp_oid: 'IF-MIB::ifInErrors.{#SNMPINDEX}'
              key: 'vlan.errors.in[{#IFDESCR}]'
              value_type: FLOAT
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: VLAN
                - tag: Metrics
                  value: Traffic
                - tag: VLAN
                  value: '{#IFDESCR}'
              trigger_prototypes:
                - uuid: 2e20cf0f2b25465ebea2488eb737a547
                  expression: 'avg(/Ubiquiti Firewall/vlan.errors.in[{#IFDESCR}],5m) > {$UBIQUITI_VLAN_ERROR_THRESHOLD}'
                  name: 'VLAN: {#IFDESCR} Inbound Errors High'
                  priority: AVERAGE
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: Interface
                    - tag: Interface
                      value: VLAN
                    - tag: Symptom
                      value: Config/Trunk
                    - tag: VLAN
                      value: '{#IFDESCR}'
            - uuid: 7c12699b501a4252848dffbd8b8f4af8
              name: 'VLAN: {#IFDESCR} Errors Out'
              type: SNMP_AGENT
              snmp_oid: 'IF-MIB::ifOutErrors.{#SNMPINDEX}'
              key: 'vlan.errors.out[{#IFDESCR}]'
              value_type: FLOAT
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: VLAN
                - tag: Metrics
                  value: Traffic
                - tag: VLAN
                  value: '{#IFDESCR}'
              trigger_prototypes:
                - uuid: 3a51ad9b9c484e4daec8d0c8d4b4b457
                  expression: 'avg(/Ubiquiti Firewall/vlan.errors.out[{#IFDESCR}],5m) > {$UBIQUITI_VLAN_ERROR_THRESHOLD}'
                  name: 'VLAN: {#IFDESCR} Outbound Errors High'
                  priority: AVERAGE
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: Interface
                    - tag: Interface
                      value: VLAN
                    - tag: Symptom
                      value: Config/Trunk
                    - tag: VLAN
                      value: '{#IFDESCR}'
          graph_prototypes:
            - uuid: 40477aefd58d410cbb6341eb1efaf388
              name: 'VLAN: {#IFDESCR} Traffic'
              graph_items:
                - color: 199C0D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'vlan.bytes.in[{#IFDESCR}]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'vlan.bytes.out[{#IFDESCR}]'
                - sortorder: '2'
                  drawtype: FILLED_REGION
                  color: 2774A4
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'vlan.errors.in[{#IFDESCR}]'
                - sortorder: '3'
                  drawtype: FILLED_REGION
                  color: F7941D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'vlan.errors.out[{#IFDESCR}]'
        - uuid: 5c464c44670c472c971b12218461d884
          name: 'VPN Tunnels (L2TP Based)'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: ubiquiti.vpn.l2tp.discovery
          delay: 1h
          status: DISABLED
          filter:
            conditions:
              - macro: '{#IFDESCR}'
                value: '^l2tp[0-9]+'
                formulaid: A
              - macro: '{#IFTYPE}'
                value: ^131$
                formulaid: B
          item_prototypes:
            - uuid: d0231c7d23ce4833b785954ef96c79b7
              name: 'VPN: {#IFDESCR} Bytes In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.10.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.l2tp.in.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: VPN-Type-Type
                  value: L2TP
            - uuid: ecf4fe40c3f544fea344de6e83f26318
              name: 'VPN: {#IFDESCR} Errors In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.l2tp.in.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: VPN-Type
                  value: L2TP
              trigger_prototypes:
                - uuid: a19dc2b3062b4686a5156d625d091fe4
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.l2tp.in.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Inbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: L2TP
            - uuid: 56b6f6f2453a41398cf38ca9fde57205
              name: 'VPN: {#IFDESCR} Bytes Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.16.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.l2tp.out.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: VPN-Type
                  value: L2TP
            - uuid: b28a0e37c1b54bfb9377aad5ec707e85
              name: 'VPN: {#IFDESCR} Errors Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.l2tp.out.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: VPN-Type
                  value: L2TP
              trigger_prototypes:
                - uuid: 26cbf1bff59e41b7960a54a106490239
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.l2tp.out.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Outbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: L2TP
            - uuid: 3bcafad82dc848ac8b87f3f4598ee473
              name: 'VPN: {#IFDESCR} Status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.l2tp.status[{#SNMPINDEX}]'
              valuemap:
                name: interface.status.valuemap
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Status
                - tag: VPN-Type
                  value: L2TP
              trigger_prototypes:
                - uuid: ceb08ec6d0934b6ab8e60c809ead90a4
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.l2tp.status[{#SNMPINDEX}],#5)<1'
                  name: 'VPN: {#IFDESCR} status flapping'
                  priority: AVERAGE
                  description: |
                    VPN interface {#IFDESCR} has been down for at least 5 polling intervals.
                    Check remote peer availability or authentication settings.
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Metrics
                      value: Status
                    - tag: Symptoms
                      value: Flap
                    - tag: VPN-Type
                      value: L2TP
          graph_prototypes:
            - uuid: ea54c6f4ffff4f05a2c43d2371dc9638
              name: 'VPN Traffic (L2TP - {#IFDESCR})'
              graph_items:
                - color: 199C0D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.l2tp.in.bytes[{#SNMPINDEX}]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.l2tp.out.bytes[{#SNMPINDEX}]'
                - sortorder: '2'
                  drawtype: FILLED_REGION
                  color: 2774A4
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.l2tp.in.errors[{#SNMPINDEX}]'
                - sortorder: '3'
                  drawtype: FILLED_REGION
                  color: F7941D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.l2tp.out.errors[{#SNMPINDEX}]'
        - uuid: 9b535186425341619783add5140f534c
          name: 'VPN Tunnels (OpenVPN Based)'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: ubiquiti.vpn.openvpn.discovery
          delay: 1h
          status: DISABLED
          filter:
            conditions:
              - macro: '{#IFDESCR}'
                value: '^ovpn[0-9]+'
                formulaid: A
              - macro: '{#IFTYPE}'
                value: ^131$
                formulaid: B
          item_prototypes:
            - uuid: 8915eb9afc564bc887a8668f8bde2059
              name: 'VPN: {#IFDESCR} Bytes In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.10.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.openvpn.in.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: VPN-Type
                  value: OpenVPN
            - uuid: 831234e26fbc47019d523757c63ad290
              name: 'VPN: {#IFDESCR} Errors In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.openvpn.in.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: VPN-Type
                  value: OpenVPN
              trigger_prototypes:
                - uuid: 64475fc2f11047199fc11c30bd5d25e6
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.openvpn.in.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Inbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: OpenVPN
            - uuid: 77dbcf41ef124a97b5b05b9e2807ccfb
              name: 'VPN: {#IFDESCR} Bytes Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.16.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.openvpn.out.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: VPN-Type
                  value: OpenVPN
            - uuid: fc4e8d20769a47c18dfcbc33d64677db
              name: 'VPN: {#IFDESCR} Errors Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.openvpn.out.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: VPN-Type
                  value: OpenVPN
              trigger_prototypes:
                - uuid: a855d79ed1db420ebc3630921f0c00ee
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.openvpn.out.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Outbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: OpenVPN
            - uuid: f89b807cae944a04acf7148e07389325
              name: 'VPN: {#IFDESCR} Status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.openvpn.status[{#SNMPINDEX}]'
              valuemap:
                name: interface.status.valuemap
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Status
                - tag: VPN-Type
                  value: OpenVPN
              trigger_prototypes:
                - uuid: ca69baa1f9f34cf6844c1385a615bbb0
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.openvpn.status[{#SNMPINDEX}],#5)<1'
                  name: 'VPN: {#IFDESCR} status flapping'
                  priority: AVERAGE
                  description: |
                    VPN interface {#IFDESCR} has been down for at least 5 polling intervals.
                    Check remote peer availability or authentication settings.
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Metrics
                      value: Status
                    - tag: Symptoms
                      value: Flap
                    - tag: VPN-Type
                      value: OpenVPN
          graph_prototypes:
            - uuid: ab98bdbcb7b74a588ea28f8587bc8af4
              name: 'VPN Traffic (OpenVPN - {#IFDESCR})'
              graph_items:
                - color: 199C0D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.openvpn.in.bytes[{#SNMPINDEX}]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.openvpn.out.bytes[{#SNMPINDEX}]'
                - sortorder: '2'
                  drawtype: FILLED_REGION
                  color: 2774A4
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.openvpn.in.errors[{#SNMPINDEX}]'
                - sortorder: '3'
                  drawtype: FILLED_REGION
                  color: F7941D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.openvpn.out.errors[{#SNMPINDEX}]'
        - uuid: f446126f34544f7e958d3165da3456eb
          name: 'VPN Tunnels (Policy Based)'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: ubiquiti.vpn.policy.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#IFDESCR}'
                value: '^ipsec[0-9]+'
                formulaid: A
              - macro: '{#IFTYPE}'
                value: ^131$
                formulaid: B
          item_prototypes:
            - uuid: a0fb7ee2b9d0476a87b309f1e006272a
              name: 'VPN: {#IFDESCR} Bytes In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.10.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.policy.in.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: VPN-Type
                  value: Policy
            - uuid: 16775155033d420abc1e1aa721ccf42b
              name: 'VPN: {#IFDESCR} Errors In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.policy.in.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: VPN-Type
                  value: Policy
              trigger_prototypes:
                - uuid: 805e65d295a94f6e944aaa83a78c0c83
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.policy.in.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Inbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: Policy
            - uuid: da1673b61bf54a87b63fd9fc19443ab7
              name: 'VPN: {#IFDESCR} Bytes Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.16.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.policy.out.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: VPN-Type
                  value: Policy
            - uuid: 697dbac948a94cf4be2b5358e2c96170
              name: 'VPN: {#IFDESCR} Errors Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.policy.out.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: VPN-Type
                  value: Policy
              trigger_prototypes:
                - uuid: 7f04e0f3bd0d47ca8b02b35b39340f54
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.policy.out.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Outbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: Policy
            - uuid: f01f0356cdcc409a864db163a9ed5362
              name: 'VPN: {#IFDESCR} Status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.policy.status[{#SNMPINDEX}]'
              valuemap:
                name: interface.status.valuemap
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Status
                - tag: VPN-Type
                  value: Policy
              trigger_prototypes:
                - uuid: 2eade4d28da64a4d8b59204d86bbecb5
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.policy.status[{#SNMPINDEX}],#5)<1'
                  name: 'VPN: {#IFDESCR} status flapping'
                  priority: AVERAGE
                  description: |
                    VPN interface {#IFDESCR} has been down for at least 5 polling intervals.
                    Check remote peer availability or authentication settings.
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Metrics
                      value: Status
                    - tag: Symptoms
                      value: Flap
                    - tag: VPN-Type
                      value: Policy
          graph_prototypes:
            - uuid: 3a5478bac279473887908f328cf3961f
              name: 'VPN Traffic (Policy - {#IFDESCR})'
              graph_items:
                - color: 199C0D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.policy.in.bytes[{#SNMPINDEX}]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.policy.out.bytes[{#SNMPINDEX}]'
                - sortorder: '2'
                  drawtype: FILLED_REGION
                  color: 2774A4
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.policy.in.errors[{#SNMPINDEX}]'
                - sortorder: '3'
                  drawtype: FILLED_REGION
                  color: F7941D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.policy.out.errors[{#SNMPINDEX}]'
        - uuid: bef91177156946d8a1b96c0e32ccaac9
          name: 'VPN Tunnels (PPTP Based)'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: ubiquiti.vpn.pptp.discovery
          delay: 1h
          status: DISABLED
          filter:
            conditions:
              - macro: '{#IFDESCR}'
                value: '^pptp[0-9]+'
                formulaid: A
              - macro: '{#IFTYPE}'
                value: ^131$
                formulaid: B
          item_prototypes:
            - uuid: bfc8fbb32d064779b0503c6a8ef3cf8d
              name: 'VPN: {#IFDESCR} Bytes In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.10.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.pptp.in.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: VPN-Type
                  value: PPTP
            - uuid: 72e7a8fd417246f18d63b881d6297128
              name: 'VPN: {#IFDESCR} Errors In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.pptp.in.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: VPN-Type
                  value: PPTP
              trigger_prototypes:
                - uuid: e0682324906948bd8e79e85f8a7f3b24
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.pptp.in.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Inbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: PPTP
            - uuid: 67066d50872f4ced8fd24133a2651045
              name: 'VPN: {#IFDESCR} Bytes Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.16.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.pptp.out.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: VPN-Type
                  value: PPTP
            - uuid: 972f854a85b946a8a27a1b6c3d6d9bf9
              name: 'VPN: {#IFDESCR} Errors Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.pptp.out.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: VPN-Type
                  value: PPTP
              trigger_prototypes:
                - uuid: dd09671e33ea45ff924a392c3b0e06b0
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.pptp.out.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Outbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: PPTP
            - uuid: 24c9503d22a24a7ead21f8511935dae2
              name: 'VPN: {#IFDESCR} Status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.pptp.status[{#SNMPINDEX}]'
              valuemap:
                name: interface.status.valuemap
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Status
                - tag: VPN-Type
                  value: PPTP
              trigger_prototypes:
                - uuid: 9559f8b9f85442919c46a70b31f1774f
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.pptp.status[{#SNMPINDEX}],#5)<1'
                  name: 'VPN: {#IFDESCR} status flapping'
                  priority: AVERAGE
                  description: |
                    VPN interface {#IFDESCR} has been down for at least 5 polling intervals.
                    Check remote peer availability or authentication settings.
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Metrics
                      value: Status
                    - tag: Symptoms
                      value: Flap
                    - tag: VPN-Type
                      value: PPTP
          graph_prototypes:
            - uuid: 8fddb867a90544d3a6cfb1482d3a44f6
              name: 'VPN Traffic (PPTP - {#IFDESCR})'
              graph_items:
                - color: 199C0D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.pptp.in.bytes[{#SNMPINDEX}]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.pptp.out.bytes[{#SNMPINDEX}]'
                - sortorder: '2'
                  drawtype: FILLED_REGION
                  color: 2774A4
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.pptp.in.errors[{#SNMPINDEX}]'
                - sortorder: '3'
                  drawtype: FILLED_REGION
                  color: F7941D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.pptp.out.errors[{#SNMPINDEX}]'
        - uuid: 3fc0097626054cdfaeaa3efe490e33b6
          name: 'VPN Tunnels (Route Based)'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: ubiquiti.vpn.route.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#IFDESCR}'
                value: '^vti[0-9]+'
                formulaid: A
              - macro: '{#IFTYPE}'
                value: ^131$
                formulaid: B
          item_prototypes:
            - uuid: 93eefbd974d74b33a0513e37381cf8df
              name: 'VPN: {#IFDESCR} Bytes In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.10.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.route.in.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: Route
            - uuid: 89e38e03781b42e5935c6c51060a067d
              name: 'VPN: {#IFDESCR} Errors In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.route.in.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: Route
              trigger_prototypes:
                - uuid: fc0a0dab7bd04e2bb6d304aee1f4e9bd
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.route.in.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Inbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: Route
            - uuid: ab9377e166cc487695015c4f839e20d0
              name: 'VPN: {#IFDESCR} Bytes Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.16.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.route.out.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: VPN-Type
                  value: Route
            - uuid: 6949d04d8c1c455c8e2921288d378f47
              name: 'VPN: {#IFDESCR} Errors Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.route.out.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: Route
              trigger_prototypes:
                - uuid: 95502fa4fe694c5f89718566ac409efb
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.route.out.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Outbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: Route
            - uuid: b6d94355ad1e410184bac6ae5af1de3f
              name: 'VPN: {#IFDESCR} Status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.route.status[{#SNMPINDEX}]'
              units: Bps
              valuemap:
                name: interface.status.valuemap
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Status
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: Route
              trigger_prototypes:
                - uuid: 89c5d814eeee4b98913ca1a78fed718d
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.route.status[{#SNMPINDEX}],#5)<1'
                  name: 'VPN: {#IFDESCR} status flapping'
                  priority: AVERAGE
                  description: |
                    VPN interface {#IFDESCR} has been down for at least 5 polling intervals.
                    Check remote peer availability or authentication settings.
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Metrics
                      value: Availability
                    - tag: Symptoms
                      value: Flap
                    - tag: VPN-Type
                      value: Route
          graph_prototypes:
            - uuid: 6254f464c55e48829f9f984d6a1a0d48
              name: 'VPN Traffic (Route - {#IFDESCR})'
              graph_items:
                - color: 199C0D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.route.in.bytes[{#SNMPINDEX}]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.route.out.bytes[{#SNMPINDEX}]'
                - sortorder: '2'
                  drawtype: FILLED_REGION
                  color: 2774A4
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.route.in.errors[{#SNMPINDEX}]'
                - sortorder: '3'
                  drawtype: FILLED_REGION
                  color: F7941D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.route.out.errors[{#SNMPINDEX}]'
        - uuid: aa59daf2a5c145e8834761376b03b683
          name: 'VPN Tunnels (Teleport Based)'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: ubiquiti.vpn.teleport.discovery
          delay: 1h
          status: DISABLED
          filter:
            conditions:
              - macro: '{#IFDESCR}'
                value: '^teleport[0-9]+'
                formulaid: A
              - macro: '{#IFTYPE}'
                value: ^131$
                formulaid: B
          item_prototypes:
            - uuid: 7ee037e92b784c21a74c4ee380725b8c
              name: 'VPN: {#IFDESCR} Bytes In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.10.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.teleport.in.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: Teleport
            - uuid: 4fce2c75718a4594be5a5660940b984f
              name: 'VPN: {#IFDESCR} Errors In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.teleport.in.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: Teleport
              trigger_prototypes:
                - uuid: 8ca6a38ba2974915a8db9c1d5c043648
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.teleport.in.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Inbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: Teleport
            - uuid: 5531dc30e45442b2ae3f928e9122cf82
              name: 'VPN: {#IFDESCR} Bytes Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.16.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.teleport.out.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: VPN-Type
                  value: Teleport
            - uuid: 74efb4dacba7478e9a0c218af5a2e873
              name: 'VPN: {#IFDESCR} Errors Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.teleport.out.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Teleport
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: Route
              trigger_prototypes:
                - uuid: 2f951c0c12b04052bf4ba3aefca8e35c
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.teleport.out.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Outbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: Teleport
            - uuid: 59b602df23a847cfa3db973ca0ef4651
              name: 'VPN: {#IFDESCR} Status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.teleport.status[{#SNMPINDEX}]'
              valuemap:
                name: interface.status.valuemap
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Status
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: Teleport
              trigger_prototypes:
                - uuid: f231f3fc1c8f4706b24e0f634948ec76
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.teleport.status[{#SNMPINDEX}],#5)<1'
                  name: 'VPN: {#IFDESCR} status flapping'
                  priority: AVERAGE
                  description: |
                    VPN interface {#IFDESCR} has been down for at least 5 polling intervals.
                    Check remote peer availability or authentication settings.
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Metrics
                      value: Status
                    - tag: Symptoms
                      value: Flap
                    - tag: VPN-Type
                      value: Teleport
          graph_prototypes:
            - uuid: 9e351ef7d74b4af6b00b7ad2426d12f4
              name: 'VPN Traffic (Teleport - {#IFDESCR})'
              graph_items:
                - color: 199C0D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.teleport.in.bytes[{#SNMPINDEX}]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.teleport.out.bytes[{#SNMPINDEX}]'
                - sortorder: '2'
                  drawtype: FILLED_REGION
                  color: 2774A4
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.teleport.in.errors[{#SNMPINDEX}]'
                - sortorder: '3'
                  drawtype: FILLED_REGION
                  color: F7941D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.teleport.out.errors[{#SNMPINDEX}]'
        - uuid: 0b33468325a1495b847043eba03cbf22
          name: 'VPN Tunnels (WireGuard Based)'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFDESCR},1.3.6.1.2.1.2.2.1.2,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: ubiquiti.vpn.wireguard.discovery
          delay: 1h
          status: DISABLED
          filter:
            conditions:
              - macro: '{#IFDESCR}'
                value: '^wg[0-9]+'
                formulaid: A
              - macro: '{#IFTYPE}'
                value: ^131$
                formulaid: B
          item_prototypes:
            - uuid: 189c0e3cce1547919a2d0379e3ad2585
              name: 'VPN: {#IFDESCR} Bytes In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.10.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.wireguard.in.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: WireGuard
            - uuid: 680d8994b25940d1bca7c57dca73a8c1
              name: 'VPN: {#IFDESCR} Errors In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.wireguard.in.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: WireGuard
              trigger_prototypes:
                - uuid: b3372752029843549fbf749784e9fae6
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.wireguard.in.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Inbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: WireGuard
            - uuid: 6c995b8b789e44908be952905baf63b2
              name: 'VPN: {#IFDESCR} Bytes Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.16.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.wireguard.out.bytes[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Traffic
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: WireGuard
            - uuid: 27f0144156234fc3b1cd9c68bb3c2f89
              name: 'VPN: {#IFDESCR} Errors Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.wireguard.out.errors[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Errors
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: WireGuard
              trigger_prototypes:
                - uuid: 25f3d92c7645416583deee052d2caf2b
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.wireguard.out.errors[{#SNMPINDEX}],5m)>{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
                  name: 'VPN: {#IFDESCR} Outbound Errors High'
                  priority: WARNING
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Symptom
                      value: Errors
                    - tag: VPN-Type
                      value: WireGuard
            - uuid: 46b06909b0b64c8a88aff983940c1019
              name: 'VPN: {#IFDESCR} Status'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.8.{#SNMPINDEX}'
              key: 'ubiquiti.vpn.wireguard.status[{#SNMPINDEX}]'
              valuemap:
                name: interface.status.valuemap
              tags:
                - tag: Component
                  value: VPN
                - tag: Metrics
                  value: Status
                - tag: Name
                  value: '{#IFDESCR}'
                - tag: VPN-Type
                  value: WireGuard
              trigger_prototypes:
                - uuid: b89fe285f75140ea9fed6de4c09f25bc
                  expression: 'avg(/Ubiquiti Firewall/ubiquiti.vpn.wireguard.status[{#SNMPINDEX}],#5)<1'
                  name: 'VPN: {#IFDESCR} status flapping'
                  priority: AVERAGE
                  description: |
                    VPN interface {#IFDESCR} has been down for at least 5 polling intervals.
                    Check remote peer availability or authentication settings.
                  manual_close: 'YES'
                  tags:
                    - tag: Component
                      value: VPN
                    - tag: Metrics
                      value: Status
                    - tag: Symptoms
                      value: Flap
                    - tag: VPN-Type
                      value: WireGuard
          graph_prototypes:
            - uuid: 9985f6b1c3d3408aa9459f172305873b
              name: 'VPN Traffic (WireGuard - {#IFDESCR})'
              graph_items:
                - color: 199C0D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.wireguard.in.bytes[{#SNMPINDEX}]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.wireguard.out.bytes[{#SNMPINDEX}]'
                - sortorder: '2'
                  drawtype: FILLED_REGION
                  color: 2774A4
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.wireguard.in.errors[{#SNMPINDEX}]'
                - sortorder: '3'
                  drawtype: FILLED_REGION
                  color: F7941D
                  calc_fnc: ALL
                  item:
                    host: 'Ubiquiti Firewall'
                    key: 'ubiquiti.vpn.wireguard.out.errors[{#SNMPINDEX}]'
        - uuid: 75f4c971511149b5b55bdc988024e9ea
          name: 'Interfaces (Extended)'
          type: SNMP_AGENT
          snmp_oid: 'discover[{#IFDESCR},1.3.6.1.2.1.31.1.1.1.1, {#IFALIAS},1.3.6.1.2.1.31.1.1.1.18]'
          key: ubiquiti.xint.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#IFDESCR}'
                value: '^(ifb?|br*)+'
                formulaid: A
          item_prototypes:
            - uuid: 3d43b4c87d1d4448b66a99cc5a33a460
              name: 'XINT: {#IFDESCR} Alias'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.10.{#SNMPINDEX}'
              key: 'ubiquiti.xint.alias[{#SNMPINDEX}]'
              delay: 5m
              value_type: TEXT
              trends: '0'
              description: 'Administrative alias for interface {#IFDESCR}, typically used for tagging in dashboards.'
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: Extended
                - tag: Metrics
                  value: Traffic
                - tag: Name
                  value: '{#IFDESCR}'
            - uuid: 46c8a1c722ef460086b1850834b5c5fa
              name: 'XINT: {#IFDESCR} Errors In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.14.{#SNMPINDEX}'
              key: 'ubiquiti.xint.extended.errors.in[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: Extended
                - tag: Metrics
                  value: Errors
                - tag: Name
                  value: '{#IFDESCR}'
            - uuid: 00c867de94254e409dc3b7b854858221
              name: 'XINT: {#IFDESCR} Errors Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.2.2.1.20.{#SNMPINDEX}'
              key: 'ubiquiti.xint.extended.errors.out[{#SNMPINDEX}]'
              units: Bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: Extended
                - tag: Metrics
                  value: Errors
                - tag: Name
                  value: '{#IFDESCR}'
            - uuid: 08a9bb885e564efeb1dc50644c92c9b5
              name: 'XINT: {#IFDESCR} Bytes In'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.6.{#SNMPINDEX}'
              key: 'ubiquiti.xint.hcin.bytes[{#SNMPINDEX}]'
              units: Bps
              description: '64-bit counter of inbound traffic on xint {#IFDESCR}, in bytes per second.'
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: Extended
                - tag: Metrics
                  value: Traffic
                - tag: Name
                  value: '{#IFDESCR}'
            - uuid: 16a6ef654deb4f0d82a9eadf3c730283
              name: 'XINT: {#IFDESCR} Bytes Out'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.31.1.1.1.10.{#SNMPINDEX}'
              key: 'ubiquiti.xint.hcout.bytes[{#SNMPINDEX}]'
              units: Bps
              description: '64-bit counter of outbound traffic on xint {#IFDESCR}, in bytes per second.'
              preprocessing:
                - type: CHANGE_PER_SECOND
                  parameters:
                    - ''
              tags:
                - tag: Component
                  value: Interface
                - tag: Interface
                  value: Extended
                - tag: Metrics
                  value: Traffic
                - tag: Name
                  value: '{#IFDESCR}'
      tags:
        - tag: Author
          value: 'Simon Jackson'
      macros:
        - macro: '{$UBIQUITI_CPU_UTIL_MAX}'
          value: '90'
          description: 'Maximum allowed CPU usage (%) before raising warning.'
        - macro: '{$UBIQUITI_INTERFACE_ERROR_THRESHOLD}'
          value: '10'
          description: 'Interface {#IFDESCR} is experiencing a high number of SEND errors. This may indicate bad cabling, duplex mismatch, or hardware issues.'
        - macro: '{$UBIQUITI_MEMORY_USED_MAX}'
          value: '95'
          description: 'Threshold for raising memory usage alerts.'
        - macro: '{$UBIQUITI_PROCESS_MAX}'
          value: '10'
          description: 'Fallback maximum process count if no specific override is defined.'
        - macro: '{$UBIQUITI_PROCESS_MAX:"dnsmasq"}'
          value: '3'
          description: 'Maximum number of allowed "dnsmasq" DNS forwarder processes.'
        - macro: '{$UBIQUITI_PROCESS_MAX:"sshd"}'
          value: '5'
          description: 'Maximum number of allowed "sshd" processes.'
        - macro: '{$UBIQUITI_PROCESS_MAX:"strongswan"}'
          value: '5'
          description: 'Maximum number of allowed "strongSwan" VPN daemon processes.'
        - macro: '{$UBIQUITI_PROCESS_MAX:"ubnt-util"}'
          value: '2'
          description: 'Maximum number of allowed "ubnt-util" system support processes.'
        - macro: '{$UBIQUITI_PROCESS_MAX:"unifi-core"}'
          value: '3'
          description: 'Maximum number of allowed "unifi-core" controller processes.'
        - macro: '{$UBIQUITI_PROCESS_MIN}'
          value: '1'
          description: 'Fallback minimum process count if no specific override is defined.'
        - macro: '{$UBIQUITI_PROCESS_MIN:"dnsmasq"}'
          value: '1'
          description: 'Minimum number of expected "dnsmasq" DNS forwarder processes.'
        - macro: '{$UBIQUITI_PROCESS_MIN:"sshd"}'
          value: '1'
          description: 'Minimum number of expected "sshd" (SSH daemon) processes.'
        - macro: '{$UBIQUITI_PROCESS_MIN:"strongswan"}'
          value: '1'
          description: 'Minimum number of expected "strongSwan" VPN daemon processes.'
        - macro: '{$UBIQUITI_PROCESS_MIN:"ubnt-util"}'
          value: '1'
          description: 'Minimum number of expected "ubnt-util" system support processes.'
        - macro: '{$UBIQUITI_PROCESS_MIN:"unifi-core"}'
          value: '1'
          description: 'Minimum number of expected "unifi-core" controller processes.'
        - macro: '{$UBIQUITI_SESSION_COUNT_MAX}'
          value: '50000'
          description: 'Higher than usual session-count could indicate DDOS attacks. Default=50k.'
        - macro: '{$UBIQUITI_STORAGE_USED_MAX:"/dev/shm"}'
          value: '95'
          description: 'Shared memory file system. Usage typically spikes with high memory applications.'
        - macro: '{$UBIQUITI_STORAGE_USED_MAX:"/opt/vyatta/config"}'
          value: '80'
          description: 'Critical system configuration storage. Should not exceed 80% usage.'
        - macro: '{$UBIQUITI_STORAGE_USED_MAX:"/root.dev"}'
          value: '85'
          description: 'Root device mount. Should stay below 85% to ensure operational integrity.'
        - macro: '{$UBIQUITI_STORAGE_USED_MAX:"/root.dev/ugw"}'
          value: '85'
          description: 'Submount of root device for UGW-specific operations. Monitor closely if used actively.'
        - macro: '{$UBIQUITI_STORAGE_USED_MAX:"/run"}'
          value: '95'
          description: 'Temporary runtime data. May fluctuate, but sustained high usage can indicate issues.'
        - macro: '{$UBIQUITI_STORAGE_USED_MAX:"/tmp"}'
          value: '90'
          description: 'Maximum allowed storage usage on /tmp mount point. Typically more flexible, but still worth monitoring.'
        - macro: '{$UBIQUITI_STORAGE_USED_MAX:"/var/log"}'
          value: '85'
          description: 'Maximum allowed storage usage on /var/log mount point before raising a warning.'
        - macro: '{$UBIQUITI_UPTIME_MIN}'
          value: '600'
          description: 'Minimum expected uptime in seconds before raising alert for recent reboot (default 600 = 10 minutes).'
        - macro: '{$UBIQUITI_VLAN_ERROR_THRESHOLD}'
          value: '10'
          description: 'Trigger threshold for interface error rates in errors per second. Applies to VLAN interfaces only.'
        - macro: '{$UBIQUITI_VPN_ERRORS_THRESHOLD}'
          value: '10'
          description: 'Trigger threshold for the number of errors (in or out) per second on ANY VPN interface.'
      dashboards:
        - uuid: fe4bb8b03c924252ab4e042110e9fc48
          name: 'Ubiquiti Firewall'
          pages:
            - name: Overview
              widgets:
                - type: problemsbysv
                  width: '31'
                  fields:
                    - type: STRING
                      name: reference
                      value: AUBWZ
                - type: honeycomb
                  name: 'Important Info'
                  'y': '2'
                  width: '22'
                  height: '4'
                  fields:
                    - type: STRING
                      name: items.0
                      value: 'Device Contact'
                    - type: STRING
                      name: items.1
                      value: 'Device Location'
                    - type: STRING
                      name: items.2
                      value: 'Device Name'
                    - type: STRING
                      name: items.3
                      value: 'Device Uptime'
                    - type: STRING
                      name: primary_label
                      value: '{ITEM.NAME}'
                    - type: STRING
                      name: reference
                      value: DRJLE
                - type: item
                  name: Uptime
                  x: '22'
                  'y': '2'
                  width: '9'
                  fields:
                    - type: INTEGER
                      name: decimal_places
                      value: '0'
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'Ubiquiti Firewall'
                        key: system.uptime
                    - type: INTEGER
                      name: show.0
                      value: '2'
                    - type: STRING
                      name: value_color
                      value: '666699'
                - type: gauge
                  x: '22'
                  'y': '4'
                  width: '9'
                  fields:
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'Ubiquiti Firewall'
                        key: ubiquiti.cpu.utilisation
                    - type: STRING
                      name: max
                      value: '100'
                    - type: STRING
                      name: min
                      value: '0'
                    - type: INTEGER
                      name: show.0
                      value: '2'
                    - type: INTEGER
                      name: show.1
                      value: '3'
                    - type: INTEGER
                      name: show.2
                      value: '5'
                - type: svggraph
                  name: 'Memory Usage'
                  x: '31'
                  width: '32'
                  height: '3'
                  fields:
                    - type: STRING
                      name: ds.0.color
                      value: 80FF00
                    - type: INTEGER
                      name: ds.0.fill
                      value: '1'
                    - type: STRING
                      name: ds.0.items.0
                      value: 'Swap Available'
                    - type: INTEGER
                      name: ds.0.transparency
                      value: '3'
                    - type: STRING
                      name: ds.1.color
                      value: 00FFFF
                    - type: INTEGER
                      name: ds.1.fill
                      value: '1'
                    - type: STRING
                      name: ds.1.items.0
                      value: 'Memory Available'
                    - type: INTEGER
                      name: ds.1.transparency
                      value: '3'
                    - type: STRING
                      name: ds.2.color
                      value: FFBF00
                    - type: INTEGER
                      name: ds.2.fill
                      value: '1'
                    - type: STRING
                      name: ds.2.items.0
                      value: 'Swap Total'
                    - type: INTEGER
                      name: ds.2.transparency
                      value: '3'
                    - type: STRING
                      name: ds.3.color
                      value: 4000FF
                    - type: INTEGER
                      name: ds.3.fill
                      value: '1'
                    - type: STRING
                      name: ds.3.items.0
                      value: 'Memory Total'
                    - type: INTEGER
                      name: ds.3.transparency
                      value: '3'
                    - type: STRING
                      name: reference
                      value: FEWYJ
                    - type: INTEGER
                      name: righty
                      value: '0'
                - type: svggraph
                  name: 'Disk Throughput (Unsupported by older FW Models)'
                  x: '31'
                  'y': '3'
                  width: '32'
                  height: '3'
                  fields:
                    - type: STRING
                      name: ds.0.color
                      value: BF00FF
                    - type: INTEGER
                      name: ds.0.fill
                      value: '1'
                    - type: STRING
                      name: ds.0.items.0
                      value: 'Disk Throughput Read'
                    - type: INTEGER
                      name: ds.0.transparency
                      value: '3'
                    - type: STRING
                      name: ds.1.color
                      value: 00BFFF
                    - type: INTEGER
                      name: ds.1.fill
                      value: '1'
                    - type: STRING
                      name: ds.1.items.0
                      value: 'Disk Throughput Write'
                    - type: INTEGER
                      name: ds.1.transparency
                      value: '3'
                    - type: STRING
                      name: reference
                      value: SWPAA
                    - type: INTEGER
                      name: righty
                      value: '0'
            - name: 'File System'
              widgets:
                - type: graphprototype
                  width: '67'
                  height: '9'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '3'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Ubiquiti Firewall'
                        name: 'FS: {#HRSTORAGEDESCR} Consumption'
                    - type: STRING
                      name: reference
                      value: FOSTC
                    - type: INTEGER
                      name: rows
                      value: '2'
            - name: Interfaces
              widgets:
                - type: honeycomb
                  name: 'Interface Statuses'
                  width: '27'
                  fields:
                    - type: STRING
                      name: items.0
                      value: '* Status'
                    - type: INTEGER
                      name: item_tags.0.operator
                      value: '1'
                    - type: STRING
                      name: item_tags.0.tag
                      value: Component
                    - type: STRING
                      name: item_tags.0.value
                      value: Interface
                    - type: STRING
                      name: primary_label
                      value: '{{ITEM.NAME}.regsub("^Interface: (.+) Status$", "\1")}'
                    - type: STRING
                      name: primary_label_color
                      value: '666699'
                    - type: STRING
                      name: reference
                      value: SNERQ
                    - type: STRING
                      name: secondary_label_color
                      value: '666699'
                    - type: INTEGER
                      name: secondary_label_decimal_places
                      value: '0'
                    - type: INTEGER
                      name: secondary_label_units_show
                      value: '0'
                    - type: STRING
                      name: thresholds.0.color
                      value: FF465C
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '0'
                    - type: STRING
                      name: thresholds.1.color
                      value: 81C784
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '1'
                - type: svggraph
                  name: 'Interface: Bytes In/Out'
                  'y': '2'
                  width: '27'
                  height: '7'
                  fields:
                    - type: STRING
                      name: ds.0.color
                      value: FF465C
                    - type: INTEGER
                      name: ds.0.fill
                      value: '1'
                    - type: STRING
                      name: ds.0.items.0
                      value: 'Interface: * Bytes In'
                    - type: INTEGER
                      name: ds.0.transparency
                      value: '3'
                    - type: STRING
                      name: ds.1.color
                      value: FFD54F
                    - type: INTEGER
                      name: ds.1.fill
                      value: '1'
                    - type: STRING
                      name: ds.1.items.0
                      value: 'Interface: * Bytes Out'
                    - type: INTEGER
                      name: ds.1.transparency
                      value: '3'
                    - type: INTEGER
                      name: ds.2.axisy
                      value: '1'
                    - type: STRING
                      name: ds.2.color
                      value: 0EC9AC
                    - type: STRING
                      name: ds.2.items.0
                      value: 'Interface: * Errors In'
                    - type: INTEGER
                      name: ds.2.transparency
                      value: '6'
                    - type: INTEGER
                      name: ds.2.type
                      value: '2'
                    - type: INTEGER
                      name: ds.3.axisy
                      value: '1'
                    - type: STRING
                      name: ds.3.color
                      value: 524BBC
                    - type: STRING
                      name: ds.3.items.0
                      value: 'Interface: * Errors Out'
                    - type: INTEGER
                      name: ds.3.transparency
                      value: '6'
                    - type: INTEGER
                      name: ds.3.type
                      value: '2'
                    - type: INTEGER
                      name: legend_columns
                      value: '3'
                    - type: INTEGER
                      name: legend_lines
                      value: '5'
                    - type: INTEGER
                      name: legend_lines_mode
                      value: '1'
                    - type: STRING
                      name: reference
                      value: ADTYD
                    - type: INTEGER
                      name: simple_triggers
                      value: '1'
                    - type: INTEGER
                      name: working_time
                      value: '1'
                - type: honeycomb
                  name: 'VLAN Statuses'
                  x: '27'
                  width: '27'
                  fields:
                    - type: STRING
                      name: items.0
                      value: '* Status'
                    - type: INTEGER
                      name: item_tags.0.operator
                      value: '1'
                    - type: STRING
                      name: item_tags.0.tag
                      value: Component
                    - type: STRING
                      name: item_tags.0.value
                      value: VLAN
                    - type: STRING
                      name: primary_label
                      value: '{{ITEM.NAME}.regsub("^Interface: (.+) Status$", "\1")}'
                    - type: STRING
                      name: primary_label_color
                      value: '666699'
                    - type: STRING
                      name: reference
                      value: RGMPO
                    - type: STRING
                      name: secondary_label_color
                      value: '666699'
                    - type: INTEGER
                      name: secondary_label_decimal_places
                      value: '0'
                    - type: INTEGER
                      name: secondary_label_units_show
                      value: '0'
                    - type: STRING
                      name: thresholds.0.color
                      value: FF465C
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '0'
                    - type: STRING
                      name: thresholds.1.color
                      value: 81C784
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '1'
                - type: graphprototype
                  name: 'VLAN Traffic'
                  x: '27'
                  'y': '2'
                  width: '27'
                  height: '7'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '1'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Ubiquiti Firewall'
                        name: 'VLAN: {#IFDESCR} Traffic'
                    - type: STRING
                      name: reference
                      value: JTKHG
            - name: VPNs
              widgets:
                - type: honeycomb
                  name: 'VPN Tunnel Statuses (All Types)'
                  width: '48'
                  fields:
                    - type: STRING
                      name: items.0
                      value: 'VPN: * Status'
                    - type: INTEGER
                      name: item_tags.0.operator
                      value: '1'
                    - type: STRING
                      name: item_tags.0.tag
                      value: Component
                    - type: STRING
                      name: item_tags.0.value
                      value: VPN
                    - type: STRING
                      name: primary_label
                      value: '{{ITEM.NAME}.regsub("^VPN: (.+) Status$", "\1")}'
                    - type: STRING
                      name: primary_label_color
                      value: '666699'
                    - type: STRING
                      name: reference
                      value: IEAVY
                    - type: STRING
                      name: secondary_label_color
                      value: '666699'
                    - type: STRING
                      name: thresholds.0.color
                      value: FF465C
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '0'
                    - type: STRING
                      name: thresholds.1.color
                      value: A5D6A7
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '1'
                - type: graphprototype
                  name: 'VPN Traffic (Route Based)'
                  'y': '2'
                  width: '48'
                  height: '5'
                  fields:
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Ubiquiti Firewall'
                        name: 'VPN Traffic (Route - {#IFDESCR})'
                    - type: STRING
                      name: reference
                      value: DNUDU
                - type: graphprototype
                  name: 'VPN Traffic (Policy Based)'
                  'y': '7'
                  width: '48'
                  height: '5'
                  fields:
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Ubiquiti Firewall'
                        name: 'VPN Traffic (Policy - {#IFDESCR})'
                    - type: STRING
                      name: reference
                      value: BMTPQ
                - type: graphprototype
                  name: 'VPN Traffic (Teleport)'
                  'y': '12'
                  width: '24'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '1'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Ubiquiti Firewall'
                        name: 'VPN Traffic (Teleport - {#IFDESCR})'
                    - type: STRING
                      name: reference
                      value: SSTSZ
                - type: graphprototype
                  name: 'VPN Traffic (L2TP)'
                  'y': '17'
                  width: '24'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '1'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Ubiquiti Firewall'
                        name: 'VPN Traffic (L2TP - {#IFDESCR})'
                    - type: STRING
                      name: reference
                      value: VIFUD
                - type: graphprototype
                  name: 'VPN Traffic (WireGuard)'
                  x: '24'
                  'y': '12'
                  width: '24'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '1'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Ubiquiti Firewall'
                        name: 'VPN Traffic (WireGuard - {#IFDESCR})'
                    - type: STRING
                      name: reference
                      value: YIVFQ
                - type: graphprototype
                  name: 'VPN Traffic (PPTP)'
                  x: '24'
                  'y': '17'
                  width: '24'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '1'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Ubiquiti Firewall'
                        name: 'VPN Traffic (PPTP - {#IFDESCR})'
                    - type: STRING
                      name: reference
                      value: MRKHB
                - type: graphprototype
                  name: 'VPN Traffic (OpenVPN)'
                  x: '48'
                  'y': '12'
                  width: '24'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '1'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'Ubiquiti Firewall'
                        name: 'VPN Traffic (OpenVPN - {#IFDESCR})'
                    - type: STRING
                      name: reference
                      value: KCCZT
      valuemaps:
        - uuid: 653407c61b9a417184d0bfd771dadd94
          name: interface.status.valuemap
          mappings:
            - value: '1'
              newvalue: Up
            - value: '2'
              newvalue: Down
            - value: '3'
              newvalue: Testing
            - value: '4'
              newvalue: Unknown
            - value: '5'
              newvalue: Dormant
            - value: '6'
              newvalue: 'Not Preent'
            - value: '7'
              newvalue: 'Lower Layer Down'
  triggers:
    - uuid: 479c56b02aeb47bc81ace1922d8f8725
      expression: |
        nodata(/Ubiquiti Firewall/ubiquiti.memory.available,12h)=0 and
        avg(/Ubiquiti Firewall/ubiquiti.memory.available,15m) < min(/Ubiquiti Firewall/ubiquiti.memory.available,12h) * 0.75 and
        ((avg(/Ubiquiti Firewall/ubiquiti.memory.total,#5) - avg(/Ubiquiti Firewall/ubiquiti.memory.available,#5)) / avg(/Ubiquiti Firewall/ubiquiti.memory.total,#5)) * 100 > {$UBIQUITI_MEMORY_USED_MAX}
      name: 'High Memory Usage'
      priority: AVERAGE
      description: 'Memory usage is unusually high relative to the past 12h baseline and exceeds the configured maximum threshold. This condition may indicate a memory leak, runaway process, or unexpected load. Suppressed if less than 12h of history exists.'
      manual_close: 'YES'
      tags:
        - tag: Component
          value: Memory
        - tag: Metrics
          value: Utilisation
        - tag: Severity
          value: Threshold
    - uuid: 4f43238e00e74d03bf32b2de382f7bdd
      expression: 'last(/Ubiquiti Firewall/system.uptime) > 1800 and avg(/Ubiquiti Firewall/ubiquiti.swap.available,12h) < min(/Ubiquiti Firewall/ubiquiti.swap.available,12h) * 0.8'
      name: 'High Swap usage'
      priority: AVERAGE
      description: 'Swap usage is above {$UBIQUITI_SWAP_USED_MAX}% averaged over 5 samples.  Indicates memory pressure or prolonged resource exhaustion.'
      manual_close: 'YES'
      tags:
        - tag: Component
          value: Seap
        - tag: Metrics
          value: Utilisation
        - tag: Severity
          value: Threshold
